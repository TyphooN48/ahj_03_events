(()=>{"use strict";function e(e,t,s){let i=Math.round(Math.random()*(t-e)+e);for(;i===s;)i=Math.round(Math.random()*(t-e)+e);return i}const t=new class{constructor(){this.boardSize=4,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.newGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n      </div>\n      <div class="score-container"> \n        Hits:<span data-id="hits" class="score hits">0</span>\n        Missed:<span data-id="missed" class="score missed">0</span>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.newGameEl.addEventListener("click",(e=>this.onNewGameClick(e))),this.boardEl=this.container.querySelector("[data-id=board]"),this.hits=this.container.querySelector("[data-id=hits]"),this.missed=this.container.querySelector("[data-id=missed]");for(let e=0;e<this.boardSize**2;e+=1){const e=document.createElement("div");e.classList.add("cell"),e.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(e)}this.cells=Array.from(this.boardEl.children)}addCellClickListener(e){this.cellClickListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach((e=>e.call(null)))}showMessage(e){alert(e)}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}};t.bindToDOM(document.querySelector("#game-container"));const s=new class{constructor(e){this.gamePlay=e,this.hits=0,this.missed=0,this.interval=null,this.gameOver=!1}init(){this.gamePlay.drawUi(),this.gamePlay.addCellClickListener((e=>this.onCellClick(e))),this.gamePlay.addNewGameListener((()=>this.newGame())),this.gamePlay.cells[e(0,15,20)].classList.add("target"),this.gameLoopInterval()}newGame(){this.gameOver=!1,this.hits=0,this.missed=0,clearInterval(this.interval),this.init()}onCellClick(e){this.gameOver||this.gamePlay.cells[e].classList.contains("target")&&(this.hits+=1,this.gamePlay.hits.innerHTML=this.hits,clearInterval(this.interval),this.interval=null,this.isGameOver(),this.gameOver||(this.gameLoop(),this.gameLoopInterval()))}gameLoop(){if(!this.gameOver){const t=this.gamePlay.cells.find((e=>e.classList.contains("target"))),s=this.gamePlay.cells.indexOf(t);t.classList.remove("target"),this.gamePlay.cells[e(0,15,s)].classList.add("target")}}gameLoopWithMiss(){this.missed+=1,this.gamePlay.missed.innerHTML=this.missed,this.gameLoop(),this.isGameOver()}gameLoopInterval(){this.interval=setInterval((()=>{this.gameLoopWithMiss.call(this)}),1e3)}isGameOver(){this.hits>=5?(this.gameOver=!0,this.gamePlay.addCellClickListener((e=>this.onCellClick(e))),this.gamePlay.showMessage("Поздравляем Вы победили!"),clearInterval(this.interval),this.interval=null):this.missed>=5&&(this.gameOver=!0,clearInterval(this.interval),this.interval=null,this.gamePlay.showMessage("Вы проиграли\nПопробуйте еще раз"))}}(t);s.init()})();